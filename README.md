Версия V0.9.1
Разработчик Дементьев Максим, июнь 2025
#
# KRGPMagic — система управления плагинами для Autodesk Revit

**KRGPMagic** — это модульная система для централизованного управления пользовательскими плагинами и их отображением на ленте Autodesk Revit. Система позволяет гибко настраивать плагины, их группировку, параметры отображения и поведения через единый XML-файл и визуальный редактор.

---

## Основные компоненты

- **KRGPMagic_Schema.xml**  
  Главный XML-файл конфигурации, в котором описываются все плагины, их параметры, группировка и отображение в интерфейсе Revit.

- **SchemaEditor**  
  Визуальный редактор конфигурации (WinForms), позволяющий добавлять, удалять и настраивать плагины, группы PulldownButton, их свойства и взаимосвязи без ручного редактирования XML.

- **PluginInfo**  
  Модель данных для описания отдельного плагина (PushButton или SplitButton): путь к сборке, класс команды, иконки, описание, параметры отображения и поведения.

- **PulldownButtonDefinitionInfo**  
  Модель для описания групповых выпадающих кнопок (PulldownButton), которые могут содержать несколько плагинов.

- **SubCommandInfo**  
  Описание подкоманд для SplitButton-плагинов.

- **PluginManager**  
  Сервис для загрузки, инициализации и управления плагинами на основе конфигурации.

- **Система сервисов**  
  Набор централизованных сервисов для управления путями, сборками и инициализацией плагинов.

---

## Принцип работы

1. **Настройка**  
   Пользователь настраивает структуру плагинов и групп через SchemaEditor, сохраняя изменения в `KRGPMagic_Schema.xml`.

2. **Загрузка**  
   При запуске Revit и загрузке KRGPMagic, система читает конфигурацию, создает вкладки, панели, кнопки и группы на ленте Revit согласно описанию.

3. **Группировка и вложенность**  
   Поддерживается группировка плагинов в PulldownButton, а для SplitButton — вложенность подкоманд.

4. **Управление**  
   Включение/отключение плагинов и групп, а также их группировка, управляются через конфигуратор без необходимости перекомпиляции кода.

---

## Структура файлов и папок

### Системные файлы (ProgramData)
- **C:\ProgramData\Autodesk\Revit\Addins\[Version]\KRGPMagic.addin**  
  Файл манифеста Revit, указывающий на точку входа системы.

- **C:\ProgramData\Autodesk\Revit\Addins\[Version]\KRGPMagic\**  
  Основная папка системы:
  - **KRGPMagic.dll** - точка входа (KRGPMagicApplication)
  - **KRGPMagic_Schema.xml** - конфигурация плагинов
  - **KRGPMagic.Plugins\** - папки с плагинами и их ресурсами
  - **Dependencies\** - общие сборки для всех плагинов

### Пользовательские данные (AppData)
- **C:\Users\[User]\AppData\Roaming\KRGPMagic\UserData\**  
  Папка для хранения пользовательских данных плагинов:
  - **[PluginName]\** - отдельная папка для каждого плагина
  - Настройки, временные файлы, кэш и другие данные плагинов

---

## Система сервисов

KRGPMagic использует централизованную систему сервисов для управления различными аспектами работы:

- **PathService**  
  Управляет путями к файлам и папкам, обеспечивая единую точку доступа к системным и пользовательским данным.

- **AssemblyService**  
  Отвечает за загрузку и валидацию сборок, используемых плагинами.

- **PluginInitializationService**  
  Управляет инициализацией плагинов и отслеживает их состояние.

- **KRGPMagicServiceProvider**  
  Статический провайдер сервисов, реализующий паттерн Dependency Injection для доступа к сервисам из любой части системы.

---

## Совместимость

- **Autodesk Revit:**  
  Поддерживаются версии Revit 2020, 2021, 2022, 2023 и выше (уточняется в зависимости от сборки плагинов).

- **.NET:**  
  Сборка ориентирована на **.NET Framework 4.8**.

- **Язык:**  
  C# 7.3.

- **Плагины:**  
  Должны реализовывать интерфейс `IExternalCommand` (Revit API).

---

## Важные особенности

- Централизованное управление всеми плагинами через один XML-файл.
- Гибкая группировка команд в PulldownButton и SplitButton.
- Визуальный редактор для удобства настройки без ручного редактирования XML.
- Поддержка иконок, описаний, версий, автозагрузки и других параметров для каждого плагина.
- Возможность быстро включать/отключать плагины и группы без перезапуска Revit.
- Система сервисов для централизованного управления ресурсами и состоянием.
- Автоматическое управление пользовательскими данными плагинов.

---

**KRGPMagic** облегчает развертывание и поддержку большого количества пользовательских команд в корпоративной среде Revit, делая процесс прозрачным и управляемым для BIM-координаторов и разработчиков.
```
## Структура папок

KRGPMagic/                   # Папка, указанная в KRGPMagic.addin
- ├── KRGPMagic.dll            # Главная сборка (из KRGPMagic.Entry.csproj) 
- ├── KRGPMagic_Schema.xml     # Конфигурационный файл (копируется из Config/)
- └── KRGPMagic.Plugins/       # Папка для DLL отдельных плагинов и их ресурсов 
-      ├── SamplePlugin/      
        ├── SamplePlugin.dll  
         └── Icons/
           └── SampleIcon_16.png 
       ├── MultiTool/
         ├── MultiTool.dll
         └── Icons/
           └── MultiTool_32.png 
       └── SchemaEditor/ 
         ├── KRGPMagic.SchemaEditor.dll 
         └── Icons/ 
           └── SchemaEditor_32.png
